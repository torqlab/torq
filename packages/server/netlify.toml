[build]
  # Build command - install dependencies (Netlify will compile TypeScript functions)
  command = "cd ../.. && bun install"
  # Functions directory
  functions = "netlify/functions"
  # Publish directory (not used for functions-only deployment)
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

# Function configuration
[functions]
  # Directory for compiled function files
  directory = "netlify/functions"
  # Node.js bundler
  node_bundler = "esbuild"

# CORS headers for all function responses
# Note: Function code will override these with UI_ORIGIN environment variable
# This serves as a fallback
[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    Access-Control-Allow-Origin = "https://pace.balov.dev"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS, DELETE"
    Access-Control-Allow-Headers = "Content-Type"
    Access-Control-Allow-Credentials = "true"

# Redirects for cleaner URLs
[[redirects]]
  from = "/strava/auth"
  to = "/.netlify/functions/strava-auth"
  status = 200

[[redirects]]
  from = "/strava/auth/callback"
  to = "/.netlify/functions/strava-auth-callback"
  status = 200

[[redirects]]
  from = "/strava/logout"
  to = "/.netlify/functions/strava-logout"
  status = 200

[[redirects]]
  from = "/strava/activities"
  to = "/.netlify/functions/strava-activities"
  status = 200

[[redirects]]
  from = "/strava/activity/*"
  to = "/.netlify/functions/strava-activity/:splat"
  status = 200
  force = true
